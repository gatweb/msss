
<section class="dashboard-progress card">
    <div class="dashboard-progress-header">
        <div class="dashboard-progress-title">
            <span class="dashboard-progress-icon">ðŸŽ¯</span>
            <span>Objectif de dons</span>
        </div>
    </div>
    <div class="dashboard-progress-bar" style="--progress-value: {{ progress }}">
        <div class="dashboard-progress-value"></div>
        <div class="dashboard-progress-label">{{ progress }}%</div>
    </div>
    <div class="dashboard-progress-summary">
        <strong>{{ totalDonations|money }}</strong>
        <span class="dashboard-progress-separator">/</span>
        <strong>{{ donationGoal|money }}</strong>
        {% if goalReached %}
            <span class="dashboard-progress-badge success">ðŸŽ‰ Objectif atteint !</span>
        {% elseif closeToGoal %}
            <span class="dashboard-progress-badge warning">Plus que {{ remainingAmount|money }} !</span>
        {% endif %}
    </div>
    <div class="dashboard-progress-note">
        {% if goalReached %}
            FÃ©licitations, tu as atteint ton objectif !
        {% elseif closeToGoal %}
            Tu es tout prÃ¨s du but, courage !
        {% else %}
            Continue sur ta lancÃ©e, tu y es presque !
        {% endif %}
    </div>
</section>

<section class="card dashboard-card">
    <div class="dashboard-card-header">
        <h2>Derniers dons</h2>
        <button class="btn btn-accent" type="button" onclick="openDonationModal()">
            <i class="fas fa-heart"></i>
            <span>Ajouter un don</span>
        </button>
    </div>
    <div class="dashboard-table-wrapper">
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>Donateur</th>
                    <th>Email</th>
                    <th class="text-right">Montant</th>
                    <th class="text-center">Date</th>
                    <th>Type</th>
                    <th>Commentaire</th>
                </tr>
            </thead>
            <tbody>
            {% if recentDonations is not empty %}
                {% for donation in recentDonations %}
                    {% set profileUrl = donation.profile_url|default('#') %}
                    {% set donorName = donation.donor_name|default('Anonyme') %}
                    {% set donorEmail = donation.donor_email|default('â€”') %}
                    {% set amount = donation.amount|default(0) %}
                    {% set comment = donation.comment|default('')|trim %}
                    {% set initials = donation.initials|default('â€”') %}
                    {% set donationType = donation.donation_type|default('') %}
                    {% set typeColor = donation.type_color|default('#f59e42') %}
                    {% set createdAt = donation.created_at %}

                    {% if createdAt is instanceof('DateTimeInterface') %}
                        {% set dateLabel = createdAt|date('d/m/Y') %}
                        {% set timeLabel = createdAt|date('H:i') %}
                    {% else %}
                        {% set timestamp = createdAt is string ? createdAt|date('U') : 'now'|date('U') %}
                        {% set dateLabel = timestamp|date('d/m/Y') %}
                        {% set timeLabel = timestamp|date('H:i') %}
                    {% endif %}
                    <tr class="dashboard-table-row" onclick="window.location.href='{{ profileUrl }}'">
                        <td>
                            <div class="donor-cell">
                                <div class="donor-avatar">{{ initials }}</div>
                                <a href="{{ profileUrl }}" class="donor-link" title="Voir le profil de {{ donorName }}" onclick="event.stopPropagation();">
                                    <span class="donor-name" title="{{ donorName }}">{{ donorName }}</span>
                                </a>
                            </div>
                        </td>
                        <td>
                            <span class="donor-email" title="{{ donorEmail }}">{{ donorEmail }}</span>
                        </td>
                        <td class="text-right">
                            <span class="donation-amount">{{ amount|money }}</span>
                        </td>
                        <td class="text-center">
                            <div class="donation-date">
                                <span>{{ dateLabel }}</span>
                                <span class="donation-time">{{ timeLabel }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="donation-type-badge" style="color: {{ typeColor }}; background-color: {{ typeColor }}22; border-color: {{ typeColor }}33;">
                                {{ donationType|replace({'_': ' '})|title }}
                            </span>
                        </td>
                        <td>
                            {% if comment != '' %}
                                <span class="donation-comment" title="{{ comment }}">{{ comment }}</span>
                            {% else %}
                                <span class="donation-comment empty">-</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="dashboard-table-empty">Aucun don rÃ©cent</td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div class="dashboard-card-footer">
        <a href="/dashboard/donators" class="btn btn-outline-primary">Voir tous les donateurs</a>
    </div>
</section>

<section class="card useful-links-card">
    <h2>Liens Utiles</h2>
    <div class="useful-links-grid">
        <a class="useful-link-card" href="https://www.amazon.fr/hz/wishlist/intro" target="_blank" rel="noopener">
            <i class="fab fa-amazon"></i>
            <span>Amazon</span>
        </a>
        <a class="useful-link-card" href="https://throne.com/nicofriend" target="_blank" rel="noopener">
            <i class="fa-solid fa-crown"></i>
            <span>Throne</span>
        </a>
        <a class="useful-link-card" href="https://mail.google.com/mail/u/0/#inbox" target="_blank" rel="noopener">
            <i class="fa-solid fa-envelope"></i>
            <span>Gmail</span>
        </a>
        <a class="useful-link-card" href="https://creator.twitch.tv/" target="_blank" rel="noopener">
            <i class="fab fa-twitch"></i>
            <span>Twitch Creator</span>
        </a>
    </div>
</section>
