{% extends layout_template %}

{% block content %}
<section class="dashboard-progress card">
    <div class="dashboard-progress-header">
        <div class="dashboard-progress-title">
            <span class="dashboard-progress-icon">ðŸŽ¯</span>
            <span>Objectif de dons</span>
        </div>
    </div>
    <div class="dashboard-progress-bar" style="--progress-value: {{ stats.progress_percentage|default(0) }}">
        <div class="dashboard-progress-value"></div>
        <div class="dashboard-progress-label">{{ stats.progress_percentage|default(0) }}%</div>
    </div>
    <div class="dashboard-progress-summary">
        <strong>{{ stats.total_donations|money }}</strong>
        <span class="dashboard-progress-separator">/</span>
        <strong>{{ stats.donation_goal|money }}</strong>
        {% if stats.goal_reached %}
            <span class="dashboard-progress-badge success">ðŸŽ‰ Objectif atteint !</span>
        {% elseif stats.close_to_goal %}
            <span class="dashboard-progress-badge warning">Plus que {{ stats.remaining_amount|money }} !</span>
        {% endif %}
    </div>
    <div class="dashboard-progress-note">
        {% if stats.goal_reached %}
            FÃ©licitations, tu as atteint ton objectif !
        {% elseif stats.close_to_goal %}
            Tu es tout prÃ¨s du but, courage !
        {% else %}
            Continue sur ta lancÃ©e, tu y es presque !
        {% endif %}
    </div>
</section>

<section class="card dashboard-card">
    <div class="dashboard-card-header">
        <h2>Derniers dons</h2>
        <button class="btn btn-accent" type="button" onclick="openDonationModal()">
            <i class="fas fa-heart"></i>
            <span>Ajouter un don</span>
        </button>
    </div>
    <div class="dashboard-table-wrapper">
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>Donateur</th>
                    <th>Email</th>
                    <th class="text-right">Montant</th>
                    <th class="text-center">Date</th>
                    <th>Type</th>
                    <th>Commentaire</th>
                </tr>
            </thead>
            <tbody>
            {% if stats.recent_donations is not empty %}
                {% for donation in stats.recent_donations %}
                    <tr class="dashboard-table-row" onclick="window.location.href='{{ donation.profile_url }}'">
                        <td>
                            <div class="donor-cell">
                                <div class="donor-avatar">{{ donation.initials }}</div>
                                <a href="{{ donation.profile_url }}" class="donor-link" title="Voir le profil de {{ donation.donor_name }}" onclick="event.stopPropagation();">
                                    <span class="donor-name" title="{{ donation.donor_name }}">{{ donation.donor_name }}</span>
                                </a>
                            </div>
                        </td>
                        <td>
                            <span class="donor-email" title="{{ donation.donor_email }}">{{ donation.donor_email }}</span>
                        </td>
                        <td class="text-right">
                            <span class="donation-amount">{{ donation.amount|money }}</span>
                        </td>
                        <td class="text-center">
                            <div class="donation-date">
                                <span>{{ donation.created_at|date('d/m/Y') }}</span>
                                <span class="donation-time">{{ donation.created_at|date('H:i') }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="donation-type-badge" style="color: {{ donation.type_color }}; background-color: {{ donation.type_color }}22; border-color: {{ donation.type_color }}33;">
                                {{ donation.donation_type|replace({'_': ' '})|title }}
                            </span>
                        </td>
                        <td>
                            {% if donation.comment %}
                                <span class="donation-comment" title="{{ donation.comment }}">{{ donation.comment }}</span>
                            {% else %}
                                <span class="donation-comment empty">-</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="dashboard-table-empty">Aucun don rÃ©cent</td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
    <div class="dashboard-card-footer">
        <a href="/dashboard/donators" class="btn btn-outline-primary">Voir tous les donateurs</a>
    </div>
</section>

<section class="card useful-links-card">
    <h2>Liens Utiles</h2>
    <div class="useful-links-grid">
        <a class="useful-link-card" href="https://www.amazon.fr/hz/wishlist/intro" target="_blank" rel="noopener">
            <i class="fab fa-amazon"></i>
            <span>Amazon</span>
        </a>
        <a class="useful-link-card" href="https://throne.com/nicofriend" target="_blank" rel="noopener">
            <i class="fa-solid fa-crown"></i>
            <span>Throne</span>
        </a>
        <a class="useful-link-card" href="https://mail.google.com/mail/u/0/#inbox" target="_blank" rel="noopener">
            <i class="fa-solid fa-envelope"></i>
            <span>Gmail</span>
        </a>
        <a class="useful-link-card" href="https://creator.twitch.tv/" target="_blank" rel="noopener">
            <i class="fab fa-twitch"></i>
            <span>Twitch Creator</span>
        </a>
    </div>
</section>
{% endblock %}
