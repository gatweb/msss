
<div class="dashboard-container">
    <!-- En-tête -->
    <div class="section-title-bar">
        <h1>Gestion des Dons</h1>
        <div class="header-actions">
            <button class="btn btn-outline" id="exportDonations">
                <i class="fas fa-download"></i> Exporter
            </button>
            <div class="dropdown">
                <button class="btn btn-outline dropdown-toggle">
                    <i class="fas fa-filter"></i> Filtrer
                </button>
                <div class="dropdown-menu">
                    <a href="#" data-period="today">Aujourd'hui</a>
                    <a href="#" data-period="week">Cette semaine</a>
                    <a href="#" data-period="month">Ce mois</a>
                    <a href="#" data-period="year">Cette année</a>
                    <a href="#" data-period="all">Tout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques des dons -->
    <div class="donations-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-euro-sign"></i>
            </div>
            <div class="stat-content">
                <h3>Total des Dons</h3>
                <p class="stat-value">{{ stats.total_amount|default(0)|number_format(2, ',', ' ') }} €</p>
                {% if stats.trend is defined %}
                <p class="stat-trend {{ stats.trend >= 0 ? 'positive' : 'negative' }}">
                    <i class="fas fa-{{ stats.trend >= 0 ? 'arrow-up' : 'arrow-down' }}"></i>
                    {{ stats.trend|abs }}% vs mois dernier
                </p>
                {% endif %}
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>Donateurs Uniques</h3>
                <p class="stat-value">{{ stats.unique_donors|default(0) }}</p>
                <p class="stat-detail">Don moyen : {{ stats.average_donation|default(0)|number_format(2, ',', ' ') }} €</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <div class="stat-content">
                <h3>Types de Dons</h3>
                <canvas id="donationTypesChart" width="100" height="100"></canvas>
            </div>
        </div>
    </div>

    <!-- Graphique des dons -->
    <div class="donations-chart-container">
        <div class="section-title-bar">
            <h2>Évolution des Dons</h2>
            <div class="chart-period-selector">
                <button class="btn btn-sm active" data-period="week">7J</button>
                <button class="btn btn-sm" data-period="month">30J</button>
                <button class="btn btn-sm" data-period="year">1A</button>
            </div>
        </div>
        <canvas id="donationsChart"></canvas>
    </div>

    <!-- Liste des dons -->
    <div class="donations-list-container">
        <div class="section-title-bar">
            <h2>Historique des Dons</h2>
            <div class="list-actions">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchDonations" placeholder="Rechercher un donateur...">
                </div>
                <select id="sortDonations">
                    <option value="date_desc">Plus récents</option>
                    <option value="date_asc">Plus anciens</option>
                    <option value="amount_desc">Montant (décroissant)</option>
                    <option value="amount_asc">Montant (croissant)</option>
                </select>
            </div>
        </div>

        <div class="donations-table-container">
            <table class="donations-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Donateur</th>
                        <th>Montant</th>
                        <th>Type</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for donation in donations %}
                        <tr data-id="{{ donation.id }}">
                            <td>
                                <div class="donation-date">
                                    {{ donation.donation_timestamp|date('d/m/Y') }}
                                    <span class="donation-time">
                                        {{ donation.donation_timestamp|date('H:i') }}
                                    </span>
                                </div>
                            </td>
                            <td>
                                <div class="donor-info">
                                    <span class="donor-name">
                                        {{ donation.donor_name }}
                                    </span>
                                    {% if donation.is_recurring %}
                                        <span class="badge badge-recurring" title="Donateur régulier">
                                            <i class="fas fa-sync-alt"></i>
                                        </span>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                <div class="donation-amount">
                                    {{ donation.amount|number_format(2, ',', ' ') }} €
                                </div>
                            </td>
                            <td>
                                <span class="donation-type {{ donation.donation_type|lower }}">
                                    {{ donation.donation_type }}
                                </span>
                            </td>
                            <td>
                                {% if donation.timer_status == 'running' %}
                                    <div class="timer-status">
                                        <i class="fas fa-clock"></i>
                                        <span class="timer" data-start="{{ donation.timer_start_time }}"
                                              data-elapsed="{{ donation.timer_elapsed_seconds }}">
                                            00:00:00
                                        </span>
                                    </div>
                                {% else %}
                                    <span class="donation-status completed">
                                        <i class="fas fa-check"></i> Terminé
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="donation-actions">
                                    {% if donation.timer_status == 'running' %}
                                        <button class="btn btn-icon stop-timer" title="Arrêter le timer">
                                            <i class="fas fa-stop"></i>
                                        </button>
                                    {% endif %}
                                    <button class="btn btn-icon view-donation" title="Voir les détails">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-icon delete-donation" title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if totalPages is defined and totalPages > 1 %}
        <div class="pagination">
            {% if currentPage > 1 %}
                <a href="?page={{ currentPage - 1 }}" class="btn btn-outline">&laquo; Précédent</a>
            {% endif %}
            
            <span class="page-info">Page {{ currentPage }} sur {{ totalPages }}</span>
            
            {% if currentPage < totalPages %}
                <a href="?page={{ currentPage + 1 }}" class="btn btn-outline">Suivant &raquo;</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal Détails du Don -->
<div class="modal" id="donationDetailsModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Détails du Don</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="donation-details">
                    <!-- Les détails seront chargés dynamiquement -->
                </div>
            </div>
        </div>
    </div>
</div>
