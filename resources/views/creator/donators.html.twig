
<div class="donators-dashboard">
    <div class="section-title-bar">
        <h1>Mes donateurs</h1>
        <div class="header-actions">
            <button class="btn btn-outline" onclick="exportDonators()">
                <i class="fas fa-download"></i> Exporter
            </button>
        </div>
    </div>

    <div class="donators-grid">
        <!-- Statistiques des donateurs -->
        <div class="stats-cards">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="stat-content">
                    <h3>Total donateurs</h3>
                    <p class="stat-value">{{ stats.total_donators|number_format }}</p>
                </div>
            </div>

            <div class="stat-card">
                <i class="fas fa-redo"></i>
                <div class="stat-content">
                    <h3>Donateurs réguliers</h3>
                    <p class="stat-value">{{ stats.recurring_donators|number_format }}</p>
                </div>
            </div>

            <div class="stat-card">
                <i class="fas fa-euro-sign"></i>
                <div class="stat-content">
                    <h3>Don moyen</h3>
                    <p class="stat-value">{{ stats.average_donation|money }}</p>
                </div>
            </div>
        </div>

        <!-- Liste des donateurs -->
        <div class="donators-list">
            <div class="list-header">
                <div class="search-box">
                    <input type="text" id="searchDonators" placeholder="Rechercher un donateur..." onkeyup="filterDonators()">
                    <i class="fas fa-search"></i>
                </div>
                <div class="filters">
                    <select id="sortDonators" onchange="sortDonators()">
                        <option value="recent">Plus récent</option>
                        <option value="amount">Montant total</option>
                        <option value="frequency">Fréquence</option>
                    </select>
                </div>
            </div>

            <div class="donators-table">
                <table>
                    <thead>
                        <tr class="donator-row">
                            <th>Statut</th>
                            <th>Dernier don</th>
                            <th>Total des dons</th>
                            <th>Fréquence</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for donator in donators %}
                        <tr class="donator-row" onclick="window.location.href='/dashboard/donators/profile?email={{ donator.donor_email|url_encode }}'" style="cursor:pointer;">
                            <td class="led-col">
                                {% set ledColor = '#95a5a6' %}
                                {% set status = donator.crm_status|default('prospect') %}
                                {% set statusLabels = {
                                    'client': 'Client',
                                    'indesirable': 'Indésirable',
                                    'attente': 'En attente',
                                    'prospect': 'Prospect',
                                    'ancien': 'Ancien'
                                } %}
                                {% if status == 'client' %}{% set ledColor = '#27ae60' %}
                                {% elseif status == 'indesirable' %}{% set ledColor = '#e74c3c' %}
                                {% elseif status == 'attente' %}{% set ledColor = '#f39c12' %}
                                {% elseif status == 'prospect' %}{% set ledColor = '#3498db' %}
                                {% elseif status == 'ancien' %}{% set ledColor = '#95a5a6' %}
                                {% endif %}
                                <span class="led-status" style="background: {{ ledColor }};" title="{{ statusLabels[status]|default(status|capitalize) }}"></span>
                            </td>
                            <td class="donator-info">
                                <div>
                                    <strong>{{ donator.donor_name }}</strong>
                                    <span>{{ donator.donor_email }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="last-donation">
                                    <span>{{ donator.last_donation|date('d/m/Y H:i') }}</span>
                                </div>
                            </td>
                            <td>
                                <strong>{{ donator.total_amount|number_format(2, ',', ' ') }}</strong>
                                <span>({{ donator.donation_count }} dons)</span>
                            </td>
                            <td>
                                <span class="badge badge-secondary">Ponctuel</span>
                            </td>
                            <td>
                                <span class="text-muted">-</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if total_pages > 1 %}
            <div class="pagination">
                {% if current_page > 1 %}
                    <a href="?page={{ current_page - 1 }}" class="btn btn-outline">
                        <i class="fas fa-chevron-left"></i> Précédent
                    </a>
                {% endif %}

                {% for i in 1..total_pages %}
                    <a href="?page={{ i }}" class="btn btn-outline {{ i == current_page ? 'active' : '' }}">
                        {{ i }}
                    </a>
                {% endfor %}

                {% if current_page < total_pages %}
                    <a href="?page={{ current_page + 1 }}" class="btn btn-outline">
                        Suivant <i class="fas fa-chevron-right"></i>
                    </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.donators-dashboard {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.section-title-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stat-card i {
    font-size: 2rem;
    color: var(--primary-color);
}

.search-box {
    position: relative;
    margin-bottom: 1rem;
}

.search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1rem;
}

.search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.donators-table {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid #eee;
}

th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
}

.donator-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.led-col {
    text-align: center;
    vertical-align: middle;
    width: 44px;
}
.led-status {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    box-shadow: 0 0 4px rgba(0,0,0,0.13);
    position: relative;
    cursor: pointer;
}
.led-status[title]:hover::after {
    content: attr(title);
    position: absolute;
    left: 50%;
    top: 120%;
    transform: translateX(-50%);
    background: #222;
    color: #fff;
    padding: 2px 8px;
    border-radius: 5px;
    font-size: 0.85em;
    white-space: nowrap;
    z-index: 9999;
    opacity: 0.98;
    pointer-events: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.17);
}

.donator-info img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.donator-info div {
    display: flex;
    flex-direction: column;
}

.donator-info span {
    font-size: 0.9rem;
    color: #666;
}

.last-donation {
    display: flex;
    flex-direction: column;
}

.badge {
    padding: 0.25rem 0.5rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-success {
    background: #e1f7e1;
    color: #2ecc71;
}

.badge-secondary {
    background: #f5f6f7;
    color: #95a5a6;
}

.actions {
    display: flex;
    gap: 0.5rem;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 2rem;
}

@media (max-width: 768px) {
    .donators-dashboard {
        padding: 1rem;
    }

    .section-title-bar {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    .stats-cards {
        grid-template-columns: 1fr;
    }

    .donators-table {
        font-size: 0.9rem;
    }

    th, td {
        padding: 0.75rem;
    }
}
</style>

<script>
function filterDonators() {
    // À implémenter : filtrage des donateurs
    const searchTerm = document.getElementById('searchDonators').value;
    console.log('Filtering donators:', searchTerm);
}

function sortDonators() {
    // À implémenter : tri des donateurs
    const sortBy = document.getElementById('sortDonators').value;
    console.log('Sorting donators by:', sortBy);
}

function exportDonators() {
    // À implémenter : export des données des donateurs
    console.log('Exporting donators data');
}

function sendMessage(donatorId) {
    // À implémenter : envoi de message à un donateur
    console.log('Sending message to donator:', donatorId);
}
</script>
